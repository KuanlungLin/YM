<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Format Upload Sheet for VC Download</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #F5F1E9;
            color: #2C3E50;
            text-align: center;
            padding: 40px;
            margin: 0;
        }
        h1 {
            color: #8B4513;
            margin-bottom: 20px;
        }
        .container {
            background-color: #FFFFFF;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }
        input[type="file"] {
            display: block;
            margin: 15px auto;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            background-color: #D2B48C;
            color: #2C3E50;
            cursor: pointer;
        }
        .button-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 30px 0 15px 0;
        }
        .ports-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .or-text {
            color: #808080;
            font-size: 16px;
        }
        button, a.download-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            background-color: #2C3E50;
            color: #FFFFFF;
            cursor: pointer;
            transition: background-color 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        button:hover:not(:disabled), a.download-btn:hover {
            background-color: #34495E;
        }
        button:disabled {
            background-color: #A9A9A9;
            cursor: not-allowed;
        }
        #clearAllBtn, #clearSelection, #saveBtn:not(:disabled), #ncpeDefaultBtn {
            background-color: #8B4513;
        }
        #clearAllBtn:hover:not(:disabled), #clearSelection:hover:not(:disabled), #saveBtn:hover:not(:disabled), #ncpeDefaultBtn:hover:not(:disabled) {
            background-color: #A0522D;
        }
        #downloadBtn:not(:disabled), #filterBtn:not(:disabled) {
            background-color: #2C3E50; /* 藍色 */
        }
        #downloadBtn:hover:not(:disabled), #filterBtn:hover:not(:disabled) {
            background-color: #34495E; /* 懸停時的藍色變暗 */
        }
        #clearPortsBtn {
            background-color: #A9A9A9;
        }
        #clearPortsBtn:not(:disabled) {
            background-color: #8B4513;
        }
        #clearPortsBtn:not(:disabled):hover {
            background-color: #A0522D;
        }
        #fileList {
            margin-top: 20px;
            color: #2C3E50;
            font-size: 16px;
            font-weight: bold;
        }
        #portsStatus {
            margin-top: 20px;
            color: #2C3E50;
            font-size: 14px;
        }
        #status {
            margin-top: 20px;
            padding: 10px;
            background-color: #F0E6D2;
            border: 2px solid #8B4513;
            border-radius: 5px;
            color: #2C3E50;
            font-size: 16px;
            font-weight: bold;
            display: none;
        }
        #langSwitch {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        #language, #reeferInput {
            padding: 5px;
            border-radius: 5px;
            background-color: #F0E6D2;
            color: #2C3E50;
            border: none;
        }
        #repoDateInput {
            background-color: #F0E6D2;
            color: #2C3E50;
            width: 120px;
        }
        .input-row {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px 0;
            position: relative;
        }
        .input-row label {
            margin-right: 10px;
            font-size: 16px;
        }
        .input-row label .date-format {
            font-size: 12px;
            color: #808080;
        }
        #repoDateInput.error {
            border: 2px solid #FF0000;
        }
        #dateError {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            color: #FF0000;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }
        #filterModal, #portsModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #FFFFFF;
            margin: 50px auto;
            padding: 20px;
            width: 80%;
            max-width: 800px;
            border-radius: 10px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .filter-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin: 15px 0;
        }
        .filter-section {
            flex: 0 1 45%;
        }
        .filter-section h3 {
            margin-bottom: 5px;
            font-size: 18px;
            text-align: left;
        }
        .filter-section .subtitle {
            font-size: 14px;
            color: #2C3E50;
            line-height: 1.2;
            text-align: left;
            margin-bottom: 15px;
        }
        .filter-options {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #D2B48C;
            padding: 10px;
            border-radius: 5px;
            background-color: #F0E6D2;
            text-align: left;
        }
        .filter-options label {
            display: block;
            margin: 5px 0 5px 0;
            color: #2C3E50;
        }
        #rowCount {
            margin: 15px 0;
            font-size: 18px;
            color: #8B4513;
        }
        #clearSelection {
            margin-top: 10px;
        }
        #portsTable {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        #portsTable th, #portsTable td {
            border: 1px solid #D2B48C;
            padding: 8px;
            text-align: left;
        }
        #portsTable th {
            background-color: #F0E6D2;
        }
        #portsTable input {
            width: 100%;
            border: none;
            background: transparent;
            color: #2C3E50;
        }
        #portsTable .error {
            background-color: #FFDCDC;
        }
        .help-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 18px;
            cursor: pointer;
        }
        .help-tooltip {
            display: none;
            position: absolute;
            top: 30px;
            right: 0;
            background-color: #FFF;
            border: 1px solid #D2B48C;
            padding: 10px;
            width: 300px;
            text-align: left;
            font-size: 14px;
            color: #2C3E50;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        .help-icon:hover + .help-tooltip {
            display: block;
        }
        .ports-upload-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }
        #backBtn {
            background-color: #A52A2A;
            margin-top: 20px;
        }
        #backBtn:hover {
            background-color: #8B1A1A;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="langSwitch">
            <select id="language" onchange="changeLanguage()">
                <option value="en">English</option>
                <option value="zh">繁體中文</option>
                <option value="de">Deutsch</option>
                <option value="el">Ελληνικά</option>
                <option value="ja">日本語</option>
                <option value="ko">한국어</option>
                <option value="ru">Русский</option>
            </select>
        </div>
        <h1 id="title">Format Upload Sheet for VC Download</h1>
        <input type="file" id="excelFile" accept=".xlsx, .xls" onchange="updateFileList()">
        <div class="ports-row">
            <button id="portsBtn" onclick="showPortsModal()" disabled>Insert Extra Ports</button>
            <button id="clearPortsBtn" onclick="clearPorts()" disabled>Clear Extra Ports</button>
        </div>
        <div class="input-row">
            <label id="reeferLabel" for="reeferInput">Reefer:</label>
            <select id="reeferInput">
                <option value="N" selected>N</option>
                <option value="Y">Y</option>
            </select>
        </div>
        <div class="input-row">
            <label id="repoDateLabel" for="repoDateInput">Repo Eff Date <span class="date-format">(YYYY.MM.DD)</span>:</label>
            <input type="text" id="repoDateInput" maxlength="10" placeholder="e.g., 2025.02.26">
            <div id="dateError"></div>
        </div>
        <div class="button-row">
            <button id="downloadBtn" onclick="processAndDownload()" disabled>Download Directly</button>
            <span class="or-text" id="orText">or</span>
            <button id="filterBtn" onclick="showFilterModal()" disabled>Filter Data</button>
        </div>
        <button id="clearAllBtn" onclick="clearFile()">Clear All</button>
        <div id="fileList"></div>
        <div id="portsStatus"></div>
        <div id="status"></div>
        <button id="backBtn" onclick="window.location.href='VC-Download-Assistant.html'">Back to Main</button>
    </div>

    <div id="filterModal">
        <div class="modal-content">
            <h2 id="filterTitle">Filter Data</h2>
            <div class="filter-container">
                <div class="filter-section">
                    <h3>Filter by Origin <span id="originReq"></span></h3>
                    <div class="subtitle" id="originSubtitle">Multiple Selection Allowed<br>Select at Least One</div>
                    <div id="fromFilter" class="filter-options"></div>
                </div>
                <div class="filter-section">
                    <h3>Filter by Destination <span id="destOpt"></span></h3>
                    <div class="subtitle" id="destSubtitle">Multiple Selection Allowed<br>Select All by Default if None Chosen</div>
                    <div id="toFilter" class="filter-options"></div>
                </div>
            </div>
            <div id="rowCount"></div>
            <button id="clearSelection" onclick="clearSelection()">Clear Selection</button>
            <button id="downloadFilteredBtn" onclick="applyFilterAndDownload()">Download Filtered Data</button>
            <button id="cancelBtn" onclick="closeModal('filterModal')">Cancel</button>
        </div>
    </div>

    <div id="portsModal">
        <div class="modal-content">
            <h2>Insert Extra Ports</h2>
            <span class="help-icon">?</span>
            <div class="help-tooltip">
                You can manually enter From and To values (5 characters, uppercase letters or numbers only) or upload an XLSX/XLS file (max 30 rows, excluding header).<br>
                - If From is empty, unique From values from the main file will be used.<br>
                - If To is empty, unique To values from the main file will be used.<br>
                - If both From and To are provided, combinations will be generated.<br>
                - Uploaded values will overwrite manually entered values if confirmed.<br>
                - Values are only saved when you click Save. If any value has an invalid format, Save will be disabled.<br>
                - Invalid values will be highlighted in red.
            </div>
            <div class="ports-upload-row">
                <input type="file" id="portsFile" accept=".xlsx, .xls" onchange="loadPortsFile()">
                <a href="Upload_Extra_Ports.xlsx" download class="download-btn" id="downloadTemplateBtn">Download Upload Format</a>
                <button id="saveBtn" onclick="savePorts()">Save</button>
                <button onclick="closeModal('portsModal')">Cancel</button>
            </div>
            <button id="ncpeDefaultBtn" onclick="setNcpeDefault()">NCPE Default</button>
            <table id="portsTable">
                <thead>
                    <tr>
                        <th>From</th>
                        <th>To</th>
                    </tr>
                </thead>
                <tbody id="portsTableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        const translations = {
            "en": {
                "title": "Format Upload Sheet for VC Download",
                "portsBtn": "Insert Extra Ports",
                "clearPortsBtn": "Clear Extra Ports",
                "downloadTemplateBtn": "Download Upload Format",
                "downloadBtn": "Download Directly",
                "orText": "or",
                "filterBtn": "Filter Data",
                "clearAllBtn": "Clear All",
                "fileListTitle": "Uploaded File:",
                "portsStatusEmpty": "Insert Extra Ports: No values added",
                "portsStatusFilled": "Insert Extra Ports: Values added",
                "noFileAlert": "Please select an Excel (.xlsx) file!",
                "processing": "Processing...",
                "complete": "Processing complete, file downloaded: ",
                "invalidDateAlert": "Please enter a valid date in YYYY.MM.DD format!",
                "filterTitle": "Filter Data",
                "originReq": "(Required)",
                "originSubtitle": "Multiple Selection Allowed<br>Select at Least One",
                "destOpt": "(Optional)",
                "destSubtitle": "Multiple Selection Allowed<br>Select All by Default if None Chosen",
                "rowCount": "Selected rows: ",
                "clearSelection": "Clear Selection",
                "downloadFilteredBtn": "Download Filtered Data",
                "cancelBtn": "Cancel",
                "backBtn": "Back to Main",
                "savePortsBtn": "Save",
                "portsUploadLimitAlert": "Uploaded file exceeds 30 rows (excluding header). Only the first 30 rows will be used.",
                "portsUploadOverwriteConfirm": "You have manually entered values. Uploading a file will overwrite them. Proceed?",
                "portsFormatError": "Invalid format at row {row}: {value}. Must be 5 characters (uppercase letters or numbers only).",
                "portsInvalidFormatAlert": "Cannot save due to invalid format in one or more fields. Values must be 5 characters (uppercase letters or numbers only).",
                "dateFormatError": "Invalid date",
                "dateRangeError": "Invalid date",
                "portsUnsavedConfirm": "You have unsaved changes in From/To values. Are you sure you want to cancel?",
                "ncpeDefaultConfirm": "This will clear all existing From/To values and apply NCPE defaults. Proceed?",
                "rowLimitAlert": "Selected rows exceed 500! Please reduce your selection.",
                "originAlert": "Please select at least one value from the 'Origin' column!",
                "fileNameEmptyAlert": "File name cannot be empty!"
            },
            "zh": {
                "title": "格式化上傳表單給 VC 下載",
                "portsBtn": "插入額外港口",
                "clearPortsBtn": "清除額外港口",
                "downloadTemplateBtn": "下載上傳格式",
                "downloadBtn": "直接下載",
                "orText": "或",
                "filterBtn": "篩選數據",
                "clearAllBtn": "全部清除",
                "fileListTitle": "已上傳檔案：",
                "portsStatusEmpty": "插入額外港口：未添加值",
                "portsStatusFilled": "插入額外港口：已添加值",
                "noFileAlert": "請選擇一個 Excel (.xlsx) 檔案！",
                "processing": "處理中...",
                "complete": "處理完成，檔案已下載：",
                "invalidDateAlert": "請輸入有效的 YYYY.MM.DD 格式日期！",
                "filterTitle": "篩選數據",
                "originReq": "(必填)",
                "originSubtitle": "允許多選<br>至少選擇一個",
                "destOpt": "(選填)",
                "destSubtitle": "允許多選<br>未選擇時預設全選",
                "rowCount": "已選行數：",
                "clearSelection": "清除選擇",
                "downloadFilteredBtn": "下載篩選後數據",
                "cancelBtn": "取消",
                "backBtn": "返回主畫面",
                "savePortsBtn": "儲存",
                "portsUploadLimitAlert": "上傳檔案超過 30 行（不含標頭）。僅使用前 30 行。",
                "portsUploadOverwriteConfirm": "您已手動輸入值。上傳檔案將覆蓋它們。是否繼續？",
                "portsFormatError": "第 {row} 行格式錯誤：{value}。必須為 5 個字元（僅限大寫字母或數字）。",
                "portsInvalidFormatAlert": "由於一個或多個欄位格式無效，無法儲存。值必須為 5 個字元（僅限大寫字母或數字）。",
                "dateFormatError": "無效日期",
                "dateRangeError": "無效日期",
                "portsUnsavedConfirm": "您在 From/To 值中有未儲存的變更。確定要取消嗎？",
                "ncpeDefaultConfirm": "這將清除所有現有 From/To 值並應用 NCPE 預設值。是否繼續？",
                "rowLimitAlert": "所選行數超過 500！請減少選擇。",
                "originAlert": "請從 'Origin' 欄位中至少選擇一個值！",
                "fileNameEmptyAlert": "檔案名稱不能為空！"
            },
            "de": {
                "title": "Upload-Blatt für VC-Download formatieren",
                "portsBtn": "Zusätzliche Häfen einfügen",
                "clearPortsBtn": "Zusätzliche Häfen löschen",
                "downloadTemplateBtn": "Upload-Format herunterladen",
                "downloadBtn": "Direkt herunterladen",
                "orText": "oder",
                "filterBtn": "Daten filtern",
                "clearAllBtn": "Alles löschen",
                "fileListTitle": "Hochgeladene Datei:",
                "portsStatusEmpty": "Zusätzliche Häfen einfügen: Keine Werte hinzugefügt",
                "portsStatusFilled": "Zusätzliche Häfen einfügen: Werte hinzugefügt",
                "noFileAlert": "Bitte wählen Sie eine Excel-Datei (.xlsx) aus!",
                "processing": "Verarbeitung...",
                "complete": "Verarbeitung abgeschlossen, Datei heruntergeladen: ",
                "invalidDateAlert": "Bitte geben Sie ein gültiges Datum im Format JJJJ.MM.TT ein!",
                "filterTitle": "Daten filtern",
                "originReq": "(Erforderlich)",
                "originSubtitle": "Mehrfachauswahl möglich<br>Mindestens eine auswählen",
                "destOpt": "(Optional)",
                "destSubtitle": "Mehrfachauswahl möglich<br>Standardmäßig alles auswählen, wenn nichts gewählt",
                "rowCount": "Ausgewählte Zeilen: ",
                "clearSelection": "Auswahl löschen",
                "downloadFilteredBtn": "Gefilterte Daten herunterladen",
                "cancelBtn": "Abbrechen",
                "backBtn": "Zurück zum Hauptbildschirm",
                "savePortsBtn": "Speichern",
                "portsUploadLimitAlert": "Die hochgeladene Datei überschreitet 30 Zeilen (ohne Kopfzeile). Nur die ersten 30 Zeilen werden verwendet。",
                "portsUploadOverwriteConfirm": "Sie haben manuell Werte eingegeben. Das Hochladen einer Datei überschreibt diese. Fortfahren?",
                "portsFormatError": "Ungültiges Format in Zeile {row}: {value}. Muss 5 Zeichen sein (nur Großbuchstaben oder Zahlen).",
                "portsInvalidFormatAlert": "Kann nicht speichern, da ein oder mehrere Felder ein ungültiges Format haben. Werte müssen 5 Zeichen sein (nur Großbuchstaben oder Zahlen).",
                "dateFormatError": "Ungültiges Datum",
                "dateRangeError": "Ungültiges Datum",
                "portsUnsavedConfirm": "Sie haben ungespeicherte Änderungen in den From/To-Werten. Möchten Sie wirklich abbrechen?",
                "ncpeDefaultConfirm": "Dies löscht alle vorhandenen From/To-Werte und wendet NCPE-Standardwerte an. Fortfahren?",
                "rowLimitAlert": "Die ausgewählten Zeilen überschreiten 500! Bitte reduzieren Sie Ihre Auswahl。",
                "originAlert": "Bitte wählen Sie mindestens einen Wert aus der 'Origin'-Spalte!",
                "fileNameEmptyAlert": "Dateiname darf nicht leer sein!"
            },
            "el": {
                "title": "Μορφοποίηση φύλλου μεταφόρτωσης για λήψη VC",
                "portsBtn": "Εισαγωγή επιπλέον λιμανιών",
                "clearPortsBtn": "Εκκαθάριση επιπλέον λιμανιών",
                "downloadTemplateBtn": "Λήψη μορφής μεταφόρτωσης",
                "downloadBtn": "Άμεση λήψη",
                "orText": "ή",
                "filterBtn": "Φιλτράρισμα δεδομένων",
                "clearAllBtn": "Εκκαθάριση όλων",
                "fileListTitle": "Ανέβηκε αρχείο:",
                "portsStatusEmpty": "Εισαγωγή επιπλέον λιμανιών: Δεν έχουν προστεθεί τιμές",
                "portsStatusFilled": "Εισαγωγή επιπλέον λιμανιών: Έχουν προστεθεί τιμές",
                "noFileAlert": "Παρακαλώ επιλέξτε ένα αρχείο Excel (.xlsx)!",
                "processing": "Επεξεργασία...",
                "complete": "Η επεξεργασία ολοκληρώθηκε, το αρχείο κατέβηκε: ",
                "invalidDateAlert": "Παρακαλώ εισαγάγετε μια έγκυρη ημερομηνία σε μορφή ΕΕΕΕ.ΜΜ.ΗΗ!",
                "filterTitle": "Φιλτράρισμα δεδομένων",
                "originReq": "(Απαιτείται)",
                "originSubtitle": "Επιτρέπεται πολλαπλή επιλογή<br>Επιλέξτε τουλάχιστον ένα",
                "destOpt": "(Προαιρετικό)",
                "destSubtitle": "Επιτρέπεται πολλαπλή επιλογή<br>Επιλογή όλων από προεπιλογή αν δεν επιλεγεί τίποτα",
                "rowCount": "Επιλεγμένες σειρές: ",
                "clearSelection": "Εκκαθάριση επιλογής",
                "downloadFilteredBtn": "Λήψη φιλτραρισμένων δεδομένων",
                "cancelBtn": "Ακύρωση",
                "backBtn": "Επιστροφή στην κύρια οθόνη",
                "savePortsBtn": "Αποθήκευση",
                "portsUploadLimitAlert": "Το ανεβασμένο αρχείο υπερβαίνει τις 30 σειρές (εκτός κεφαλίδας). Θα χρησιμοποιηθούν μόνο οι πρώτες 30 σειρές。",
                "portsUploadOverwriteConfirm": "Έχετε εισαγάγει χειροκίνητα τιμές. Η μεταφόρτωση αρχείου θα τις αντικαταστήσει. Συνεχίζετε;",
                "portsFormatError": "Μη έγκυρη μορφή στη σειρά {row}: {value}. Πρέπει να είναι 5 χαρακτήρες (μόνο κεφαλαία γράμματα ή αριθμοί).",
                "portsInvalidFormatAlert": "Δεν μπορεί να αποθηκευτεί λόγω μη έγκυρης μορφής σε ένα ή περισσότερα πεδία. Οι τιμές πρέπει να είναι 5 χαρακτήρες (μόνο κεφαλαία γράμματα ή αριθμοί).",
                "dateFormatError": "Μη έγκυρη ημερομηνία",
                "dateRangeError": "Μη έγκυρη ημερομηνία",
                "portsUnsavedConfirm": "Έχετε μη αποθηκευμένες αλλαγές στις τιμές From/To. Είστε σίγουροι ότι θέλετε να ακυρώσετε;",
                "ncpeDefaultConfirm": "Αυτό θα διαγράψει όλες τις υπάρχουσες τιμές From/To και θα εφαρμόσει τις προεπιλογές NCPE. Συνεχίζετε;",
                "rowLimitAlert": "Οι επιλεγμένες σειρές υπερβαίνουν τις 500! Παρακαλώ μειώστε την επιλογή σας。",
                "originAlert": "Παρακαλώ επιλέξτε τουλάχιστον μία τιμή από τη στήλη 'Origin'!",
                "fileNameEmptyAlert": "Το όνομα του αρχείου δεν μπορεί να είναι κενό!"
            },
            "ja": {
                "title": "VCダウンロード用アップロードシートのフォーマット",
                "portsBtn": "追加ポートを挿入",
                "clearPortsBtn": "追加ポートをクリア",
                "downloadTemplateBtn": "アップロード形式をダウンロード",
                "downloadBtn": "直接ダウンロード",
                "orText": "または",
                "filterBtn": "データをフィルタリング",
                "clearAllBtn": "すべてクリア",
                "fileListTitle": "アップロードされたファイル：",
                "portsStatusEmpty": "追加ポートの挿入：値が追加されていません",
                "portsStatusFilled": "追加ポートの挿入：値が追加されました",
                "noFileAlert": "Excelファイル（.xlsx）を選択してください！",
                "processing": "処理中...",
                "complete": "処理が完了しました、ファイルがダウンロードされました：",
                "invalidDateAlert": "有効な日付をYYYY.MM.DD形式で入力してください！",
                "filterTitle": "データをフィルタリング",
                "originReq": "(必須)",
                "originSubtitle": "複数選択可能<br>少なくとも1つ選択",
                "destOpt": "(任意)",
                "destSubtitle": "複数選択可能<br>選択がない場合はデフォルトで全て選択",
                "rowCount": "選択された行数：",
                "clearSelection": "選択をクリア",
                "downloadFilteredBtn": "フィルタリングされたデータをダウンロード",
                "cancelBtn": "キャンセル",
                "backBtn": "メイン画面に戻る",
                "savePortsBtn": "保存",
                "portsUploadLimitAlert": "アップロードされたファイルが30行（ヘッダーを除く）を超えています。最初の30行のみ使用されます。",
                "portsUploadOverwriteConfirm": "手動で値を入力しました。ファイルをアップロードするとそれらが上書きされます。続行しますか？",
                "portsFormatError": "行 {row} の形式が無効です：{value}。5文字（大文字または数字のみ）である必要があります。",
                "portsInvalidFormatAlert": "1つ以上のフィールドの形式が無効なため保存できません。値は5文字（大文字または数字のみ）である必要があります。",
                "dateFormatError": "無効な日付",
                "dateRangeError": "無効な日付",
                "portsUnsavedConfirm": "From/To値に未保存の変更があります。本当にキャンセルしますか？",
                "ncpeDefaultConfirm": "これにより既存のすべてのFrom/To値がクリアされ、NCPEデフォルトが適用されます。続行しますか？",
                "rowLimitAlert": "選択した行数が500を超えています！選択を減らしてください。",
                "originAlert": "'Origin'列から少なくとも1つの値を選択してください！",
                "fileNameEmptyAlert": "ファイル名を空にすることはできません！"
            },
            "ko": {
                "title": "VC 다운로드용 업로드 시트 포맷",
                "portsBtn": "추가 포트 삽입",
                "clearPortsBtn": "추가 포트 지우기",
                "downloadTemplateBtn": "업로드 형식 다운로드",
                "downloadBtn": "직접 다운로드",
                "orText": "또는",
                "filterBtn": "데이터 필터링",
                "clearAllBtn": "모두 지우기",
                "fileListTitle": "업로드된 파일:",
                "portsStatusEmpty": "추가 포트 삽입: 값이 추가되지 않음",
                "portsStatusFilled": "추가 포트 삽입: 값이 추가됨",
                "noFileAlert": "Excel 파일(.xlsx)을 선택하세요!",
                "processing": "처리 중...",
                "complete": "처리 완료, 파일 다운로드됨: ",
                "invalidDateAlert": "유효한 날짜를 YYYY.MM.DD 형식으로 입력하세요!",
                "filterTitle": "데이터 필터링",
                "originReq": "(필수)",
                "originSubtitle": "다중 선택 가능<br>최소 하나 선택",
                "destOpt": "(선택)",
                "destSubtitle": "다중 선택 가능<br>선택하지 않으면 기본으로 모두 선택",
                "rowCount": "선택된 행: ",
                "clearSelection": "선택 지우기",
                "downloadFilteredBtn": "필터링된 데이터 다운로드",
                "cancelBtn": "취소",
                "backBtn": "메인 화면으로 돌아가기",
                "savePortsBtn": "저장",
                "portsUploadLimitAlert": "업로드된 파일이 30행(헤더 제외)을 초과했습니다. 처음 30행만 사용됩니다。",
                "portsUploadOverwriteConfirm": "수동으로 값을 입력했습니다. 파일을 업로드하면 덮어씌워집니다. 계속하시겠습니까?",
                "portsFormatError": "{row} 행에서 잘못된 형식: {value}. 5자(대문자 또는 숫자만)여야 합니다。",
                "portsInvalidFormatAlert": "하나 이상의 필드 형식이 잘못되어 저장할 수 없습니다. 값은 5자(대문자 또는 숫자만)여야 합니다。",
                "dateFormatError": "잘못된 날짜",
                "dateRangeError": "잘못된 날짜",
                "portsUnsavedConfirm": "From/To 값에 저장되지 않은 변경 사항이 있습니다. 정말 취소하시겠습니까?",
                "ncpeDefaultConfirm": "이렇게 하면 기존의 모든 From/To 값이 지워지고 NCPE 기본값이 적용됩니다. 계속하시겠습니까?",
                "rowLimitAlert": "선택한 행이 500개를 초과했습니다! 선택을 줄여주세요。",
                "originAlert": "'Origin' 열에서 최소 하나 이상의 값을 선택하세요!",
                "fileNameEmptyAlert": "파일 이름을 비울 수 없습니다!"
            },
            "ru": {
                "title": "Форматировать лист загрузки для скачивания VC",
                "portsBtn": "Вставить дополнительные порты",
                "clearPortsBtn": "Очистить дополнительные порты",
                "downloadTemplateBtn": "Скачать формат загрузки",
                "downloadBtn": "Скачать напрямую",
                "orText": "или",
                "filterBtn": "Фильтровать данные",
                "clearAllBtn": "Очистить все",
                "fileListTitle": "Загруженный файл:",
                "portsStatusEmpty": "Вставить дополнительные порты: значения не добавлены",
                "portsStatusFilled": "Вставить дополнительные порты: значения добавлены",
                "noFileAlert": "Пожалуйста, выберите файл Excel (.xlsx)!",
                "processing": "Обработка...",
                "complete": "Обработка завершена, файл скачан: ",
                "invalidDateAlert": "Пожалуйста, введите действительную дату в формате ГГГГ.ММ.ДД!",
                "filterTitle": "Фильтровать данные",
                "originReq": "(Обязательно)",
                "originSubtitle": "Разрешено множественный выбор<br>Выберите хотя бы одно",
                "destOpt": "(Необязательно)",
                "destSubtitle": "Разрешено множественный выбор<br>По умолчанию выбирается все, если ничего не выбрано",
                "rowCount": "Выбранные строки: ",
                "clearSelection": "Очистить выбор",
                "downloadFilteredBtn": "Скачать отфильтрованные данные",
                "cancelBtn": "Отмена",
                "backBtn": "Вернуться на главный экран",
                "savePortsBtn": "Сохранить",
                "portsUploadLimitAlert": "Загруженный файл превышает 30 строк (без учета заголовка). Будут использованы только первые 30 строк。",
                "portsUploadOverwriteConfirm": "Вы ввели значения вручную. Загрузка файла перезапишет их. Продолжить?",
                "portsFormatError": "Недопустимый формат в строке {row}: {value}. Должно быть 5 символов (только заглавные буквы или цифры).",
                "portsInvalidFormatAlert": "Невозможно сохранить из-за недопустимого формата в одном или нескольких полях. Значения должны быть 5 символов (только заглавные буквы или цифры).",
                "dateFormatError": "Недопустимая дата",
                "dateRangeError": "Недопустимая дата",
                "portsUnsavedConfirm": "В значениях From/To есть несохраненные изменения. Вы уверены, что хотите отменить?",
                "ncpeDefaultConfirm": "Это очистит все существующие значения From/To и применит стандартные значения NCPE. Продолжить?",
                "rowLimitAlert": "Выбранные строки превышают 500! Пожалуйста, уменьшите выбор。",
                "originAlert": "Пожалуйста, выберите хотя бы одно значение из столбца 'Origin'!",
                "fileNameEmptyAlert": "Имя файла не может быть пустым!"
            }
        };

        let currentLang = localStorage.getItem('language') || 'en';
        let uploadedFile = null;
        let processedData = null;
        let portsData = Array(30).fill().map(() => ['', '']);
        let savedPortsData = Array(30).fill().map(() => ['', '']);

        function changeLanguage() {
            currentLang = document.getElementById('language').value;
            localStorage.setItem('language', currentLang);
            applyTranslations();
        }

        function applyTranslations() {
            document.getElementById('language').value = currentLang;
            document.getElementById('title').textContent = translations[currentLang].title;
            document.getElementById('portsBtn').textContent = translations[currentLang].portsBtn;
            document.getElementById('clearPortsBtn').textContent = translations[currentLang].clearPortsBtn;
            document.getElementById('downloadTemplateBtn').textContent = translations[currentLang].downloadTemplateBtn;
            document.getElementById('downloadBtn').textContent = translations[currentLang].downloadBtn;
            document.getElementById('orText').textContent = translations[currentLang].orText;
            document.getElementById('filterBtn').textContent = translations[currentLang].filterBtn;
            document.getElementById('clearAllBtn').textContent = translations[currentLang].clearAllBtn;
            document.getElementById('backBtn').textContent = translations[currentLang].backBtn;
            document.getElementById('filterTitle').textContent = translations[currentLang].filterTitle;
            document.getElementById('originReq').textContent = translations[currentLang].originReq;
            document.getElementById('originSubtitle').innerHTML = translations[currentLang].originSubtitle;
            document.getElementById('destOpt').textContent = translations[currentLang].destOpt;
            document.getElementById('destSubtitle').innerHTML = translations[currentLang].destSubtitle;
            document.getElementById('clearSelection').textContent = translations[currentLang].clearSelection;
            document.getElementById('downloadFilteredBtn').textContent = translations[currentLang].downloadFilteredBtn;
            document.getElementById('cancelBtn').textContent = translations[currentLang].cancelBtn;
            document.getElementById('saveBtn').textContent = translations[currentLang].savePortsBtn;
            displayFileName();
            updatePortsStatus();
            updateRowCount();
        }

        function updateFileList() {
            const file = document.getElementById('excelFile').files[0];
            if (file) {
                uploadedFile = file;
                displayFileName();
                document.getElementById('portsBtn').disabled = false;
                document.getElementById('downloadBtn').disabled = false;
                document.getElementById('filterBtn').disabled = false;
            } else {
                uploadedFile = null;
                document.getElementById('portsBtn').disabled = true;
                document.getElementById('clearPortsBtn').disabled = true;
                document.getElementById('downloadBtn').disabled = true;
                document.getElementById('filterBtn').disabled = true;
            }
            updatePortsStatus();
        }

        function displayFileName() {
            const fileList = document.getElementById('fileList');
            fileList.innerHTML = uploadedFile ?
                `<h3>${translations[currentLang].fileListTitle}</h3><p>${uploadedFile.name}</p>` : '';
        }

        function updatePortsStatus() {
            const portsStatus = document.getElementById('portsStatus');
            const hasValues = savedPortsData.some(row => row[0] || row[1]);
            portsStatus.textContent = hasValues ?
                translations[currentLang].portsStatusFilled :
                translations[currentLang].portsStatusEmpty;
            document.getElementById('clearPortsBtn').disabled = !hasValues || !uploadedFile;
            document.getElementById('portsBtn').disabled = !uploadedFile;
        }

        function clearFile() {
            uploadedFile = null;
            portsData = Array(30).fill().map(() => ['', '']);
            savedPortsData = Array(30).fill().map(() => ['', '']);
            document.getElementById('excelFile').value = '';
            document.getElementById('reeferInput').value = 'N';
            document.getElementById('repoDateInput').value = '';
            document.getElementById('portsBtn').disabled = true;
            document.getElementById('clearPortsBtn').disabled = true;
            document.getElementById('downloadBtn').disabled = true;
            document.getElementById('filterBtn').disabled = true;
            displayFileName();
            updatePortsStatus();
            document.getElementById('status').style.display = 'none';
            document.getElementById('status').textContent = '';
            document.getElementById('dateError').style.display = 'none';
            document.getElementById('repoDateInput').classList.remove('error');
        }

        document.getElementById('repoDateInput').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 4 && value.length <= 6) {
                value = value.slice(0, 4) + '.' + value.slice(4);
            } else if (value.length > 6) {
                value = value.slice(0, 4) + '.' + value.slice(4, 6) + '.' + value.slice(6, 8);
            }
            e.target.value = value;

            const dateError = document.getElementById('dateError');
            const regex = /^\d{4}\.\d{2}\.\d{2}$/;
            if (value === '') {
                e.target.classList.remove('error');
                dateError.style.display = 'none';
            } else if (!regex.test(value)) {
                e.target.classList.add('error');
                dateError.textContent = translations[currentLang].dateFormatError;
                dateError.style.display = 'block';
            } else {
                const [year, month, day] = value.split('.').map(Number);
                const date = new Date(year, month - 1, day);
                if (date.getFullYear() !== year || date.getMonth() !== month - 1 || date.getDate() !== day) {
                    e.target.classList.add('error');
                    dateError.textContent = translations[currentLang].dateRangeError;
                    dateError.style.display = 'block';
                } else {
                    e.target.classList.remove('error');
                    dateError.style.display = 'none';
                }
            }
        });

        function isValidDateFormat(dateStr) {
            const regex = /^\d{4}\.\d{2}\.\d{2}$/;
            if (!regex.test(dateStr)) return false;
            const [year, month, day] = dateStr.split('.').map(Number);
            const date = new Date(year, month - 1, day);
            return date.getFullYear() === year && date.getMonth() === month - 1 && date.getDate() === day;
        }

        function isValidPortValue(value) {
            return value.length === 5 && /^[A-Z0-9]{5}$/.test(value);
        }

        function insertValues(data, callback) {
            let fromValues = savedPortsData.map(row => row[0]).filter(v => v);
            let toValues = savedPortsData.map(row => row[1]).filter(v => v);
            let newRows = [];

            if (fromValues.length === 0 && toValues.length === 0) {
                callback(data);
                return;
            }

            if (fromValues.length > 0 && toValues.length > 0) {
                toValues.forEach(toValue => {
                    fromValues.forEach(fromValue => {
                        newRows.push([fromValue, toValue]);
                    });
                });
                callback(data.concat(newRows));
                return;
            }

            const uniqueFrom = [...new Set(data.map(row => row[0]).filter(v => v))];
            const uniqueTo = [...new Set(data.map(row => row[1]).filter(v => v))];

            if (fromValues.length === 0) {
                toValues.forEach(toValue => {
                    uniqueFrom.forEach(fromValue => {
                        newRows.push([fromValue, toValue]);
                    });
                });
            } else if (toValues.length === 0) {
                uniqueTo.forEach(toValue => {
                    fromValues.forEach(fromValue => {
                        newRows.push([fromValue, toValue]);
                    });
                });
            }

            callback(data.concat(newRows));
        }

        function processInitialData(callback) {
            const status = document.getElementById('status');
            status.textContent = translations[currentLang].processing;
            status.style.display = 'block';

            if (!uploadedFile) {
                alert(translations[currentLang].noFileAlert);
                status.style.display = 'none';
                return;
            }

            const repoDateValue = document.getElementById('repoDateInput').value.trim();
            if (repoDateValue && !isValidDateFormat(repoDateValue)) {
                alert(translations[currentLang].invalidDateAlert);
                status.style.display = 'none';
                return;
            }

            const reeferInput = document.getElementById('reeferInput').value;
            const reeferValue = reeferInput === 'Y' ? 'Y' : '';

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                
                let jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
                
                if (jsonData.length > 3) {
                    jsonData = jsonData.slice(1);
                    jsonData = jsonData.slice(0, -1);
                    jsonData = jsonData.slice(0, -1);
                } else {
                    jsonData = [];
                }
                
                let processed = jsonData.map(row => {
                    const firstColumn = row[0] ? String(row[0]).split('-') : [''];
                    return firstColumn;
                });

                insertValues(processed, (finalData) => {
                    const headerRow = ['From', 'To', 'From Term', 'To Term', 'Reefer', 'Repo Eff Date', 'Case Id', 'SOC'];
                    processedData = [headerRow].concat(finalData);

                    for (let i = 1; i < processedData.length; i++) {
                        if (!processedData[i][0] || processedData[i][0].trim() === '') {
                            break;
                        }
                        processedData[i][2] = processedData[i][2] || 'PIER';
                        processedData[i][3] = processedData[i][3] || 'PIER';
                        processedData[i][4] = processedData[i][4] || reeferValue;
                        processedData[i][5] = processedData[i][5] || repoDateValue;
                    }

                    callback();
                });
            };
            reader.readAsArrayBuffer(uploadedFile);
        }

        function processAndDownload() {
            processInitialData(() => {
                let userFileName;
                do {
                    userFileName = prompt("Please enter the file name for download:", `Processed-${uploadedFile.name}`);
                    if (userFileName === null) return;
                    if (userFileName.trim() === "") {
                        alert(translations[currentLang].fileNameEmptyAlert);
                    }
                } while (userFileName.trim() === "");
                
                const outputFileName = userFileName + ".xlsx";
                const newWorkbook = XLSX.utils.book_new();
                const newWorksheet = XLSX.utils.aoa_to_sheet(processedData);
                XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, "Processed");
                XLSX.writeFile(newWorkbook, outputFileName);
                document.getElementById('status').textContent = `${translations[currentLang].complete}${outputFileName}`;
                document.getElementById('status').style.display = 'block';
            });
        }

        function showFilterModal() {
            processInitialData(() => {
                const fromFilter = document.getElementById('fromFilter');
                const toFilter = document.getElementById('toFilter');
                
                const fromValues = [...new Set(processedData.slice(1).map(row => row[0]).filter(v => v))];
                const toValues = [...new Set(processedData.slice(1).map(row => row[1]).filter(v => v))];

                fromFilter.innerHTML = fromValues.map(val => 
                    `<label><input type="checkbox" name="from" value="${val}" onchange="updateRowCount()"> ${val}</label>`
                ).join('');
                
                toFilter.innerHTML = toValues.map(val => 
                    `<label><input type="checkbox" name="to" value="${val}" onchange="updateRowCount()"> ${val}</label>`
                ).join('');

                document.getElementById('filterModal').style.display = 'block';
                document.getElementById('status').style.display = 'none';
                updateRowCount();
            });
        }

        function showPortsModal() {
            portsData = savedPortsData.map(row => [...row]);
            document.getElementById('portsModal').style.display = 'block';
            document.getElementById('portsFile').value = '';
            displayPortsTable();
            updateSavePortsButtonState();
        }

        function closeModal(modalId) {
            if (modalId === 'portsModal') {
                const hasUnsavedChanges = portsData.some((row, index) => 
                    row[0] !== savedPortsData[index][0] || row[1] !== savedPortsData[index][1]
                );
                if (hasUnsavedChanges && !confirm(translations[currentLang].portsUnsavedConfirm)) {
                    return;
                }
            }
            document.getElementById(modalId).style.display = 'none';
            updatePortsStatus();
        }

        function loadPortsFile() {
            const file = document.getElementById('portsFile').files[0];
            if (!file) return;

            const hasManualInput = portsData.some(row => row[0] || row[1]);
            if (hasManualInput && !confirm(translations[currentLang].portsUploadOverwriteConfirm)) {
                document.getElementById('portsFile').value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const portsDataArray = new Uint8Array(e.target.result);
                const workbook = XLSX.read(portsDataArray, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                
                let jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });
                const uploadedPorts = jsonData.slice(1).map(row => [row[0] || '', row[1] || '']);
                
                if (uploadedPorts.length > 30) {
                    alert(translations[currentLang].portsUploadLimitAlert);
                    portsData = uploadedPorts.slice(0, 30);
                } else {
                    portsData = uploadedPorts.concat(Array(30 - uploadedPorts.length).fill().map(() => ['', '']));
                }

                let errorMessage = '';
                portsData.forEach((row, index) => {
                    if (row[0] && !isValidPortValue(row[0])) {
                        errorMessage += translations[currentLang].portsFormatError
                            .replace('{row}', index + 1)
                            .replace('{value}', row[0]) + '\n';
                    }
                    if (row[1] && !isValidPortValue(row[1])) {
                        errorMessage += translations[currentLang].portsFormatError
                            .replace('{row}', index + 1)
                            .replace('{value}', row[1]) + '\n';
                    }
                });
                if (errorMessage) {
                    alert(errorMessage);
                }

                displayPortsTable();
                updateSavePortsButtonState();
            };
            reader.readAsArrayBuffer(file);
        }

        function setNcpeDefault() {
            const hasManualInput = portsData.some(row => row[0] || row[1]);
            if (hasManualInput && !confirm(translations[currentLang].ncpeDefaultConfirm)) {
                return;
            }
            const ncpeToValues = ["THLKR", "TWTAO", "VNPX1", "VNHPP", "TWTPE", "VNSPT", "VNLHP", "VNVUT", "VNGNT"];
            portsData = Array(30).fill().map(() => ['', '']);
            ncpeToValues.forEach((value, index) => {
                portsData[index][1] = value;
            });
            displayPortsTable();
            updateSavePortsButtonState();
        }

        function displayPortsTable() {
            const tbody = document.getElementById('portsTableBody');
            tbody.innerHTML = '';
            for (let i = 0; i < 30; i++) {
                const row = portsData[i] || ['', ''];
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="${row[0] && !isValidPortValue(row[0]) ? 'error' : ''}">
                        <input type="text" value="${row[0]}" maxlength="5" oninput="updatePortsData(${i}, 0, this)">
                    </td>
                    <td class="${row[1] && !isValidPortValue(row[1]) ? 'error' : ''}">
                        <input type="text" value="${row[1]}" maxlength="5" oninput="updatePortsData(${i}, 1, this)">
                    </td>
                `;
                tbody.appendChild(tr);
            }
        }

        function updatePortsData(rowIndex, colIndex, input) {
            let value = input.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            if (value.length > 5) value = value.slice(0, 5);
            input.value = value;
            while (portsData.length <= rowIndex) {
                portsData.push(['', '']);
            }
            portsData[rowIndex][colIndex] = value;
            input.parentElement.className = value && !isValidPortValue(value) ? 'error' : '';
            updateSavePortsButtonState();
        }

        function clearPorts() {
            savedPortsData = Array(30).fill().map(() => ['', '']);
            portsData = Array(30).fill().map(() => ['', '']);
            updatePortsStatus();
        }

        function updateSavePortsButtonState() {
            const saveBtn = document.getElementById('saveBtn');
            const hasValues = portsData.some(row => row[0] || row[1]);
            const hasInvalid = portsData.some(row => 
                (row[0] && !isValidPortValue(row[0])) || 
                (row[1] && !isValidPortValue(row[1]))
            );
            saveBtn.disabled = !hasValues || hasInvalid;
            if (hasInvalid) {
                saveBtn.title = translations[currentLang].portsInvalidFormatAlert;
            } else {
                saveBtn.title = '';
            }
        }

        function savePorts() {
            if (portsData.some(row => (row[0] && !isValidPortValue(row[0])) || (row[1] && !isValidPortValue(row[1])))) {
                alert(translations[currentLang].portsInvalidFormatAlert);
                return;
            }
            savedPortsData = portsData.map(row => [...row]);
            closeModal('portsModal');
            updatePortsStatus();
        }

        function updateRowCount() {
            const fromChecked = Array.from(document.querySelectorAll('input[name="from"]:checked')).map(cb => cb.value);
            const toChecked = Array.from(document.querySelectorAll('input[name="to"]:checked')).map(cb => cb.value);

            const filteredRows = processedData.slice(1).filter(row => 
                fromChecked.includes(row[0]) && 
                (toChecked.length === 0 || toChecked.includes(row[1]))
            ).length;

            document.getElementById('rowCount').textContent = `${translations[currentLang].rowCount}${filteredRows}`;
        }

        function clearSelection() {
            document.querySelectorAll('input[name="from"]').forEach(cb => cb.checked = false);
            document.querySelectorAll('input[name="to"]').forEach(cb => cb.checked = false);
            updateRowCount();
        }

        function applyFilterAndDownload() {
            processInitialData(() => {
                const fromChecked = Array.from(document.querySelectorAll('input[name="from"]:checked')).map(cb => cb.value);
                const toChecked = Array.from(document.querySelectorAll('input[name="to"]:checked')).map(cb => cb.value);

                if (fromChecked.length === 0) {
                    alert(translations[currentLang].originAlert);
                    return;
                }

                const filteredData = [processedData[0]].concat(
                    processedData.slice(1).filter(row => 
                        fromChecked.includes(row[0]) && 
                        (toChecked.length === 0 || toChecked.includes(row[1]))
                    )
                );

                const rowCount = filteredData.length - 1;
                if (rowCount > 500) {
                    alert(translations[currentLang].rowLimitAlert);
                    return;
                }

                let userFileName;
                do {
                    userFileName = prompt("Please enter the file name for download:", `Filtered-${uploadedFile.name}`);
                    if (userFileName === null) return;
                    if (userFileName.trim() === "") {
                        alert(translations[currentLang].fileNameEmptyAlert);
                    }
                } while (userFileName.trim() === "");

                const outputFileName = userFileName + ".xlsx";
                const newWorkbook = XLSX.utils.book_new();
                const newWorksheet = XLSX.utils.aoa_to_sheet(filteredData);
                XLSX.utils.book_append_sheet(newWorkbook, newWorksheet, "Filtered");
                XLSX.writeFile(newWorkbook, outputFileName);
                
                document.getElementById('status').textContent = `${translations[currentLang].complete}${outputFileName}`;
                document.getElementById('status').style.display = 'block';
                closeModal('filterModal');
            });
        }

        // 初始化語言
        applyTranslations();
    </script>
</body>
</html>